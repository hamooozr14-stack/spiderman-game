<!DOCTYPE html>
<html>
<head>
<title>Spider-Man 2 Mini Game</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial; background:#87CEEB; }
canvas { display:block; margin:auto; background:#87CEEB; }
#overlay, #gameOverOverlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.9); color:white; display:flex;
  flex-direction:column; justify-content:center; align-items:center;
  font-family:Arial; z-index:10;
}
button {
  padding:10px 20px; margin:10px; font-size:16px; cursor:pointer;
}
#backBtn, #restartBtn { 
  position:absolute; top:10px; right:10px; z-index:5; padding:8px 16px; font-size:14px; cursor:pointer; display:none;
}
#restartBtn { right:120px; }
</style>
</head>
<body>

<div id="overlay">
  <h1>Spider-Man 2 Mini</h1>
  <p>Select Difficulty:</p>
  <div>
    <button onclick="startGame('easy')">Easy</button>
    <button onclick="startGame('medium')">Medium</button>
    <button onclick="startGame('hard')">Hard</button>
    <button onclick="startGame('impossible')">Impossible</button>
  </div>
  <p>Arrow keys to move/jump, click to swing, space to shoot webs!</p>
</div>

<div id="gameOverOverlay" style="display:none;">
  <h1>GAME OVER</h1>
  <p id="finalScore"></p>
  <p id="finalHighScore"></p>
  <p id="finalTime"></p>
  <button onclick="restartGame()">Restart</button>
  <button onclick="backToMenu()">Back</button>
</div>

<button id="backBtn" onclick="backToMenu()">Back</button>
<button id="restartBtn" onclick="restartGame()">Restart</button>

<canvas id="game" width="800" height="400"></canvas>

<script>
// Canvas and UI
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let overlay = document.getElementById("overlay");
let backBtn = document.getElementById("backBtn");
let restartBtn = document.getElementById("restartBtn");
let gameOverOverlay = document.getElementById("gameOverOverlay");
let finalScoreEl = document.getElementById("finalScore");
let finalHighEl = document.getElementById("finalHighScore");
let finalTimeEl = document.getElementById("finalTime");

// Input
let keys = {};
let mouse = {x:0, y:0, down:false};
window.addEventListener("keydown", e => keys[e.code]=true);
window.addEventListener("keyup", e=>keys[e.code]=false);
canvas.addEventListener("mousedown", e => { mouse.down=true; mouse.x=e.offsetX; mouse.y=e.offsetY; });
canvas.addEventListener("mouseup", e => { mouse.down=false; });
canvas.addEventListener("mousemove", e => { mouse.x=e.offsetX; mouse.y=e.offsetY; });

// Game Variables
let spiderman, cameraX, gravity, projectiles, enemies, powerUps, obstacles;
let farBuildings, closeBuildings;
let gameStarted = false;
let enemySpawnRate = 2000;
let currentDifficulty = 'easy';
let highScores = {easy:0, medium:0, hard:0, impossible:0};
let gameOver = false;
let startTime = 0;

// Sound Effects
let jumpSound = new Audio("https://www.soundjay.com/button/beep-07.mp3");
let swingSound = new Audio("https://www.soundjay.com/button/button-16.mp3");
let hitSound = new Audio("https://www.soundjay.com/button/button-3.mp3");
let gameOverSound = new Audio("https://www.soundjay.com/button/beep-10.mp3");

// Load high scores
for(let diff in highScores){
  let stored = localStorage.getItem('spiderman_high_'+diff);
  if(stored) highScores[diff] = parseInt(stored);
}

// Start Game
function startGame(difficulty){
  overlay.style.display = "none";
  gameOverOverlay.style.display = "none";
  backBtn.style.display = "block";
  restartBtn.style.display = "block";
  currentDifficulty = difficulty;
  initGame(difficulty);
  gameStarted = true;
  gameOver = false;
  startTime = Date.now();
  loop();
}

// Back to menu
function backToMenu(){
  overlay.style.display = "flex";
  backBtn.style.display = "none";
  restartBtn.style.display = "none";
  gameOverOverlay.style.display = "none";
  gameStarted = false;
  clearInterval(window.enemyInterval);
}

// Restart current difficulty
function restartGame(){
  gameOverOverlay.style.display = "none";
  initGame(currentDifficulty);
  spiderman.health = 100;
  spiderman.score = 0;
  gameOver = false;
  gameStarted = true;
  startTime = Date.now();
}

// Initialize Game
function initGame(difficulty){
  spiderman = {x:100, y:300, w:40, h:60, dx:0, dy:0, onGround:false, health:100, score:0, swinging:false, web:null, swingLength:0, swingAngle:0, swingSpeed:0};
  cameraX = 0;
  gravity = 0.6;
  projectiles = [];
  enemies = [];
  powerUps = [];
  obstacles = [];
  farBuildings = [];
  closeBuildings = [];

  // Difficulty sets spawn rate
  if(difficulty==='easy') enemySpawnRate=3000;
  if(difficulty==='medium') enemySpawnRate=2000;
  if(difficulty==='hard') enemySpawnRate=1000;
  if(difficulty==='impossible') enemySpawnRate=300;

  // Buildings
  for(let i=0;i<30;i++){
    let w = 50 + Math.random()*50;
    let h = 100 + Math.random()*250;
    let x = i*80;
    let y = canvas.height - h;
    farBuildings.push({x, y, w, h});
  }
  for(let i=0;i<20;i++){
    let w = 60 + Math.random()*60;
    let h = 50 + Math.random()*150;
    let x = i*120;
    let y = canvas.height - h;
    closeBuildings.push({x, y, w, h});
  }

  // Spawn enemies
  if(window.enemyInterval) clearInterval(window.enemyInterval);
  window.enemyInterval = setInterval(spawnEnemy, enemySpawnRate);

  // Spawn obstacles
  for(let i=0;i<10;i++){
    let x = 100 + i*200;
    let y = 250 + Math.random()*100;
    obstacles.push({x, y, w:50, h:10, dx:Math.random()<0.5?1:-1});
  }

  // Spawn power-ups
  for(let i=0;i<5;i++){
    let x = 150 + i*300;
    let y = 200 + Math.random()*100;
    let type = Math.random()<0.5?"health":"speed";
    powerUps.push({x,y,type,collected:false});
  }
}

// Spawn Enemy
function spawnEnemy(){
  let b = closeBuildings[Math.floor(Math.random()*closeBuildings.length)];
  let speed = 1 + Math.random()*2;
  if(currentDifficulty==='hard') speed +=1;
  if(currentDifficulty==='impossible') speed +=3;
  enemies.push({x: b.x + 10, y: b.y-40, w:30, h:40, dx:Math.random()<0.5?-speed:speed});
}

// Shoot Web
function shootProjectile() {
  let dir = spiderman.dx >= 0 ? 1 : -1;
  projectiles.push({ 
    x: spiderman.x + (dir === 1 ? 40 : 0), 
    y: spiderman.y + 30, 
    dx: 8 * dir 
  });
  swingSound.play();
}

// Update
function update(){
  if(!gameStarted || gameOver) return;

  cameraX = spiderman.x - 200;
  spiderman.dx = 0;

  // Movement
  if(keys["ArrowLeft"]) spiderman.dx = -5;
  if(keys["ArrowRight"]) spiderman.dx = 5;

  // Jump
  if(keys["ArrowUp"] && spiderman.onGround){
    spiderman.dy = -12;
    spiderman.onGround = false;
    jumpSound.play();
  }

  // Shoot
  if(keys["Space"]){ shootProjectile(); keys["Space"]=false; }

  // Swing start
  if(mouse.down && !spiderman.swinging){
    spiderman.web = {x: mouse.x + cameraX, y: mouse.y};
    let dx = spiderman.web.x - (spiderman.x+20);
    let dy = spiderman.web.y - (spiderman.y+30);
    spiderman.swingLength = Math.sqrt(dx*dx + dy*dy);
    spiderman.swingAngle = Math.atan2(dy, dx);
    spiderman.swingSpeed = 0;
    spiderman.swinging = true;
  }

  // Swing physics
  if(spiderman.swinging && spiderman.web){
    let g = gravity;
    spiderman.swingSpeed += (g / spiderman.swingLength) * Math.sin(spiderman.swingAngle);
    spiderman.swingSpeed *= 0.995;
    spiderman.swingAngle += spiderman.swingSpeed;
    spiderman.x = spiderman.web.x - Math.cos(spiderman.swingAngle) * spiderman.swingLength - spiderman.w/2;
    spiderman.y = spiderman.web.y - Math.sin(spiderman.swingAngle) * spiderman.swingLength - spiderman.h/2;
    spiderman.x += spiderman.dx;

    if(!mouse.down){
      spiderman.dx += spiderman.swingSpeed * spiderman.swingLength*0.1;
      spiderman.dy = spiderman.swingSpeed * spiderman.swingLength*0.2;
      spiderman.swinging = false;
      spiderman.web = null;
    }
  } else {
    spiderman.dy += gravity;
    spiderman.x += spiderman.dx;
    spiderman.y += spiderman.dy;
  }

  spiderman.onGround=false;

  // Platform collisions
  closeBuildings.forEach(b=>{
    if(spiderman.x< b.x+b.w && spiderman.x+spiderman.w>b.x &&
       spiderman.y+spiderman.h>b.y && spiderman.y+spiderman.h<b.y+20){
        spiderman.y=b.y-spiderman.h;
        spiderman.dy=0;
        spiderman.onGround=true;
        spiderman.swinging=false;
        spiderman.web=null;
    }
  });

  // Obstacles collisions
  obstacles.forEach(obs=>{
    obs.x += obs.dx;
    if(obs.x<0 || obs.x>2000) obs.dx*=-1;
    if(spiderman.x< obs.x+obs.w && spiderman.x+spiderman.w>obs.x &&
       spiderman.y+spiderman.h>obs.y && spiderman.y+spiderman.h<obs.y+10){
         spiderman.y=obs.y-spiderman.h;
         spiderman.dy=0;
         spiderman.onGround=true;
    }
  });

  if(spiderman.y+spiderman.h>canvas.height){
    spiderman.y=canvas.height-spiderman.h;
    spiderman.dy=0;
    spiderman.onGround=true;
    spiderman.swinging=false;
    spiderman.web=null;
  }

  // Projectiles
  projectiles.forEach(p => p.x += p.dx);
  projectiles = projectiles.filter(p => p.x < cameraX + canvas.width && p.x > cameraX);

  // Enemy movement & collision
  enemies.forEach((e,ei)=>{
    e.x += e.dx;
    if(e.x<0 || e.x>2000) e.dx*=-1;

    projectiles.forEach((p,pi)=>{
      if(p.x < e.x+e.w && p.x+10>e.x && p.y < e.y+e.h && p.y>e.y){
        enemies.splice(ei,1);
        projectiles.splice(pi,1);
        spiderman.score +=10;
        hitSound.play();
      }
    });

    if(spiderman.x<e.x+e.w && spiderman.x+spiderman.w>e.x &&
       spiderman.y<e.y+e.h && spiderman.y+spiderman.h>e.y){
      spiderman.health -=0.5;
    }
  });

  // Power-ups
  powerUps.forEach(p=>{
    if(!p.collected && spiderman.x<p.x+20 && spiderman.x+spiderman.w>p.x &&
       spiderman.y< p.y+20 && spiderman.y+spiderman.h>p.y){
      p.collected=true;
      if(p.type==="health") spiderman.health +=20;
      if(p.type==="speed") spiderman.dx *=1.5;
    }
  });

  // Update high score
  if(spiderman.score > highScores[currentDifficulty]){
    highScores[currentDifficulty] = Math.floor(spiderman.score);
    localStorage.setItem('spiderman_high_'+currentDifficulty, highScores[currentDifficulty]);
  }

  // Check game over
  if(spiderman.health <=0){
    gameOver = true;
    gameStarted = false;
    gameOverSound.play();
    showGameOver();
  }

  draw();
}

// Show Game Over
function showGameOver(){
  finalScoreEl.textContent = "Score: "+Math.floor(spiderman.score);
  finalHighEl.textContent = "High Score ("+currentDifficulty+"): "+highScores[currentDifficulty];
  let seconds = Math.floor((Date.now()-startTime)/1000);
  finalTimeEl.textContent = "Time Survived: "+seconds+" seconds";
  gameOverOverlay.style.display = "flex";
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background
  ctx.fillStyle="#87CEEB";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Buildings
  ctx.fillStyle="#555";
  farBuildings.forEach(b=>ctx.fillRect(b.x - cameraX*0.5, b.y, b.w, b.h));
  ctx.fillStyle="#888";
  closeBuildings.forEach(b=>ctx.fillRect(b.x - cameraX, b.y, b.w, b.h));

  // Obstacles
  ctx.fillStyle="brown";
  obstacles.forEach(obs=>ctx.fillRect(obs.x - cameraX, obs.y, obs.w, obs.h));

  // Power-ups
  powerUps.forEach(p=>{
    if(!p.collected){
      ctx.fillStyle = p.type==="health"?"pink":"cyan";
      ctx.fillRect(p.x - cameraX, p.y, 20, 20);
    }
  });

  // Web
  if(spiderman.swinging && spiderman.web){
    ctx.strokeStyle="white";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(spiderman.x+20 - cameraX, spiderman.y+30);
    ctx.lineTo(spiderman.web.x - cameraX, spiderman.web.y);
    ctx.stroke();
  }

  // Spider-Man
  ctx.fillStyle="red";
  ctx.fillRect(spiderman.x - cameraX, spiderman.y+20, spiderman.w, 40);
  ctx.beginPath();
  ctx.arc(spiderman.x+20 - cameraX, spiderman.y+10, 10,0,Math.PI*2);
  ctx.fill();

  // Projectiles
  ctx.fillStyle="yellow";
  projectiles.forEach(p => ctx.fillRect(p.x - cameraX, p.y, 10, 2));

  // Enemies
  ctx.fillStyle="green";
  enemies.forEach(e=>ctx.fillRect(e.x - cameraX, e.y, e.w, e.h));

  // UI
  ctx.fillStyle="white";
  ctx.font="16px Arial";
  ctx.fillText("Health: "+Math.floor(spiderman.health),10,20);
  ctx.fillText("Score: "+Math.floor(spiderman.score),10,40);
  ctx.fillText("High Score ("+currentDifficulty+"): "+highScores[currentDifficulty],10,60);
}

// Loop
function loop(){ update(); requestAnimationFrame(loop); }
</script>
</body>
</html>
